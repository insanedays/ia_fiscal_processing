generate_payload:
  description: "Transforma uma pergunta do usuário em um payload de consulta estruturada para o banco."
  prompt: |
    Sua tarefa é transformar perguntas em linguagem natural sobre dados fiscais em um payload JSON estruturado, usando as tabelas e campos fornecidos no contexto.

    Formato de saída obrigatório (nunca explique, apenas gere o JSON puro):

    {
        "filters": {
            "NFHeader": {
                "campo1": "valor1",
                ...
            },
            "NFItens": {
                "campo2": "valor2",
                ...
            }
        },
        "fields": [
            "NFHeader.campoX",
            "NFItens.campoY",
            ...
        ]
    }

    Regras:

    - Use sempre os campos válidos conforme o catálogo fornecido.
    - Separe corretamente os filtros por tabela.
    - Se o usuário não indicar filtros, apenas monte os fields.
    - Nunca gere campos inexistentes ou criados por suposição.
    - Não gere nenhum texto além do JSON.

    Catálogo de dados:

    {catalogo_de_dados_injetado_pelo_rag}

    Pergunta do usuário:
    """
    {input_do_usuario}
    """


validate_payload:
  description: "Valida e corrige um payload gerado, garantindo que todos os campos e tabelas existem no catálogo."
  prompt: |
    Você irá receber um payload de consulta no formato JSON. Valide se:

    - Todas as tabelas existem no catálogo.
    - Todos os campos são válidos para as respectivas tabelas.
    - Ajuste eventuais campos com erro de digitação (typos simples).
    - Remova qualquer campo inexistente.
    - Retorne sempre o JSON validado e limpo. Não gere nenhum texto explicativo.

    Catálogo de dados disponível:

    {catalogo_de_dados_injetado_pelo_rag}

    Payload recebido:
    """
    {payload_gerado}
    """


rewrite_response:
  description: "Formata a resposta do banco de forma resumida e amigável para o usuário."
  prompt: |
rewrite_response:
  description: "Formata a resposta do banco de forma resumida e amigável para o usuário."
  prompt: |
    Você receberá:
    - A pergunta original do usuário.
    - O resultado bruto da consulta SQL (normalmente uma lista de linhas e colunas).

    Sua tarefa é:

    - Gerar uma resposta textual resumida e fácil de entender.
    - Basear a resposta tanto no resultado SQL quanto na intenção da pergunta.
    - Caso o resultado contenha muitos registros, forneça um resumo geral.
    - Nunca invente dados, sempre respeite o conteúdo recebido.
    - Mantenha o foco objetivo: os dados fiscais solicitados.

    Pergunta do usuário:
    """
    {input_do_usuario}
    """

    Resultado da consulta:
    """
    {resultado_sql}
    """

